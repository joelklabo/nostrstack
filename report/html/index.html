<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Copy/Paste Detector Report</title><link href="styles/tailwind.css" rel="stylesheet"><link href="styles/prism.css" rel="stylesheet"></head><body class="bg-gray-100"><header class="bg-white shadow py-4"><div class="container mx-auto px-4"><h1 class="text-3xl font-semibold text-gray-800">jscpd - copy/paste report</h1></div></header><main class="container mx-auto my-8 p-4 bg-white shadow rounded"><section class="mb-8" id="dashboard"><h2 class="text-2xl font-semibold text-gray-700 mb-4">Dashboard</h2><div class="grid grid-cols-4 gap-4"><div class="bg-blue-200 p-4 rounded text-center"><h3 class="text-lg font-semibold text-blue-800 mb-2">Total Files</h3><span class="text-4xl font-bold text-blue-800">265</span></div><div class="bg-green-200 p-4 rounded text-center"><h3 class="text-lg font-semibold text-green-800 mb-2">Total Lines of Code</h3><span class="text-4xl font-bold text-green-800">21417</span></div><div class="bg-yellow-200 p-4 rounded text-center"><h3 class="text-lg font-semibold text-yellow-800 mb-2">Number of Clones</h3><span class="text-4xl font-bold text-yellow-800">67</span></div><div class="bg-red-200 p-4 rounded text-center"><h3 class="text-lg font-semibold text-red-800 mb-2">Duplicated Lines</h3><span class="text-4xl font-bold text-red-800">1095 (5.11%)</span></div></div></section><section class="mb-8" id="formats"><h2 class="text-2xl font-semibold text-gray-700 mb-4">Formats with Duplications</h2><table class="w-full table-auto"><thead><tr class="bg-gray-200 text-gray-600 uppercase text-sm leading-normal"><th class="py-3 px-6 text-left">Format</th><th class="py-3 px-6 text-left">Files</th><th class="py-3 px-6 text-left">Lines</th><th class="py-3 px-6 text-left">Clones</th><th class="py-3 px-6 text-left">Duplicated Lines</th><th class="py-3 px-6 text-left">Duplicated Tokens</th></tr></thead><tbody><tr class="bg-white border-b border-gray-200 text-gray-800 text-sm"><td class="py-3 px-6"><a class="text-blue-600 hover:underline" href="#sql-clones">sql</a></td><td class="py-3 px-6">2</td><td class="py-3 px-6">136</td><td class="py-3 px-6">1</td><td class="py-3 px-6">68</td><td class="py-3 px-6">598</td></tr><tr class="bg-white border-b border-gray-200 text-gray-800 text-sm"><td class="py-3 px-6"><a class="text-blue-600 hover:underline" href="#typescript-clones">typescript</a></td><td class="py-3 px-6">90</td><td class="py-3 px-6">6001</td><td class="py-3 px-6">21</td><td class="py-3 px-6">235</td><td class="py-3 px-6">3009</td></tr><tr class="bg-white border-b border-gray-200 text-gray-800 text-sm"><td class="py-3 px-6"><a class="text-blue-600 hover:underline" href="#javascript-clones">javascript</a></td><td class="py-3 px-6">39</td><td class="py-3 px-6">3049</td><td class="py-3 px-6">6</td><td class="py-3 px-6">152</td><td class="py-3 px-6">1530</td></tr><tr class="bg-white border-b border-gray-200 text-gray-800 text-sm"><td class="py-3 px-6"><a class="text-blue-600 hover:underline" href="#tsx-clones">tsx</a></td><td class="py-3 px-6">36</td><td class="py-3 px-6">7072</td><td class="py-3 px-6">33</td><td class="py-3 px-6">510</td><td class="py-3 px-6">5283</td></tr><tr class="bg-white border-b border-gray-200 text-gray-800 text-sm"><td class="py-3 px-6"><a class="text-blue-600 hover:underline" href="#markup-clones">markup</a></td><td class="py-3 px-6">4</td><td class="py-3 px-6">35</td><td class="py-3 px-6">0</td><td class="py-3 px-6">0</td><td class="py-3 px-6">0</td></tr><tr class="bg-white border-b border-gray-200 text-gray-800 text-sm"><td class="py-3 px-6"><a class="text-blue-600 hover:underline" href="#json-clones">json</a></td><td class="py-3 px-6">22</td><td class="py-3 px-6">733</td><td class="py-3 px-6">1</td><td class="py-3 px-6">32</td><td class="py-3 px-6">157</td></tr><tr class="bg-white border-b border-gray-200 text-gray-800 text-sm"><td class="py-3 px-6"><a class="text-blue-600 hover:underline" href="#bash-clones">bash</a></td><td class="py-3 px-6">21</td><td class="py-3 px-6">1118</td><td class="py-3 px-6">0</td><td class="py-3 px-6">0</td><td class="py-3 px-6">0</td></tr><tr class="bg-white border-b border-gray-200 text-gray-800 text-sm"><td class="py-3 px-6"><a class="text-blue-600 hover:underline" href="#css-clones">css</a></td><td class="py-3 px-6">3</td><td class="py-3 px-6">43</td><td class="py-3 px-6">0</td><td class="py-3 px-6">0</td><td class="py-3 px-6">0</td></tr><tr class="bg-white border-b border-gray-200 text-gray-800 text-sm"><td class="py-3 px-6"><a class="text-blue-600 hover:underline" href="#markdown-clones">markdown</a></td><td class="py-3 px-6">33</td><td class="py-3 px-6">1276</td><td class="py-3 px-6">0</td><td class="py-3 px-6">0</td><td class="py-3 px-6">0</td></tr><tr class="bg-white border-b border-gray-200 text-gray-800 text-sm"><td class="py-3 px-6"><a class="text-blue-600 hover:underline" href="#yaml-clones">yaml</a></td><td class="py-3 px-6">10</td><td class="py-3 px-6">642</td><td class="py-3 px-6">4</td><td class="py-3 px-6">87</td><td class="py-3 px-6">611</td></tr><tr class="bg-white border-b border-gray-200 text-gray-800 text-sm"><td class="py-3 px-6"><a class="text-blue-600 hover:underline" href="#python-clones">python</a></td><td class="py-3 px-6">5</td><td class="py-3 px-6">1312</td><td class="py-3 px-6">1</td><td class="py-3 px-6">11</td><td class="py-3 px-6">119</td></tr></tbody></table></section><section class="mb-8" id="txt-clones"><a name="sql-clones"></a><h2 class="text-2xl font-semibold text-gray-700 mb-4">sql</h2><div class="divide-y divide-gray-200 border-b-2"><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/apps/api/prisma/pg-migrations/20251128_init.sql (Line 1:1 - Line 69:2), /Users/honk/code/nostrstack/apps/api/prisma/pg/migrations/20251128164619_init/migration.sql (Line 1:1 - Line 69:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn8" onclick="toggleCodeBlock('cloneGroup8', 'expandBtn8', 'collapseBtn8')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn8" onclick="toggleCodeBlock('cloneGroup8', 'expandBtn8', 'collapseBtn8')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup8"><code class="language-sql text-sm text-gray-800">-- CreateTable
CREATE TABLE &quot;Tenant&quot; (
    &quot;id&quot; TEXT NOT NULL,
    &quot;domain&quot; TEXT NOT NULL,
    &quot;displayName&quot; TEXT NOT NULL,
    &quot;createdAt&quot; TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    &quot;updatedAt&quot; TIMESTAMP(3) NOT NULL,

    CONSTRAINT &quot;Tenant_pkey&quot; PRIMARY KEY (&quot;id&quot;)
);

-- CreateTable
CREATE TABLE &quot;User&quot; (
    &quot;id&quot; TEXT NOT NULL,
    &quot;tenantId&quot; TEXT NOT NULL,
    &quot;pubkey&quot; TEXT NOT NULL,
    &quot;lightningAddress&quot; TEXT,
    &quot;createdAt&quot; TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    &quot;updatedAt&quot; TIMESTAMP(3) NOT NULL,

    CONSTRAINT &quot;User_pkey&quot; PRIMARY KEY (&quot;id&quot;)
);

-- CreateTable
CREATE TABLE &quot;Payment&quot; (
    &quot;id&quot; TEXT NOT NULL,
    &quot;tenantId&quot; TEXT NOT NULL,
    &quot;userId&quot; TEXT,
    &quot;provider&quot; TEXT NOT NULL,
    &quot;providerRef&quot; TEXT NOT NULL,
    &quot;invoice&quot; TEXT NOT NULL,
    &quot;amountSats&quot; INTEGER NOT NULL,
    &quot;status&quot; TEXT NOT NULL DEFAULT 'PENDING',
    &quot;metadata&quot; TEXT,
    &quot;createdAt&quot; TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    &quot;updatedAt&quot; TIMESTAMP(3) NOT NULL,

    CONSTRAINT &quot;Payment_pkey&quot; PRIMARY KEY (&quot;id&quot;)
);

-- CreateIndex
CREATE UNIQUE INDEX &quot;Tenant_domain_key&quot; ON &quot;Tenant&quot;(&quot;domain&quot;);

-- CreateIndex
CREATE UNIQUE INDEX &quot;User_tenantId_pubkey_key&quot; ON &quot;User&quot;(&quot;tenantId&quot;, &quot;pubkey&quot;);

-- CreateIndex
CREATE UNIQUE INDEX &quot;User_tenantId_lightningAddress_key&quot; ON &quot;User&quot;(&quot;tenantId&quot;, &quot;lightningAddress&quot;);

-- CreateIndex
CREATE UNIQUE INDEX &quot;Payment_invoice_key&quot; ON &quot;Payment&quot;(&quot;invoice&quot;);

-- CreateIndex
CREATE INDEX &quot;Payment_tenantId_idx&quot; ON &quot;Payment&quot;(&quot;tenantId&quot;);

-- CreateIndex
CREATE INDEX &quot;Payment_tenantId_userId_idx&quot; ON &quot;Payment&quot;(&quot;tenantId&quot;, &quot;userId&quot;);

-- CreateIndex
CREATE UNIQUE INDEX &quot;Payment_provider_providerRef_tenantId_key&quot; ON &quot;Payment&quot;(&quot;provider&quot;, &quot;providerRef&quot;, &quot;tenantId&quot;);

-- AddForeignKey
ALTER TABLE &quot;User&quot; ADD CONSTRAINT &quot;User_tenantId_fkey&quot; FOREIGN KEY (&quot;tenantId&quot;) REFERENCES &quot;Tenant&quot;(&quot;id&quot;) ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE &quot;Payment&quot; ADD CONSTRAINT &quot;Payment_tenantId_fkey&quot; FOREIGN KEY (&quot;tenantId&quot;) REFERENCES &quot;Tenant&quot;(&quot;id&quot;) ON DELETE CASCADE ON UPDATE CASCADE;

-- AddForeignKey
ALTER TABLE &quot;Payment&quot; ADD CONSTRAINT &quot;Payment_userId_fkey&quot; FOREIGN KEY (&quot;userId&quot;) REFERENCES &quot;User&quot;(&quot;id&quot;) ON DELETE SET NULL ON UPDATE CASCADE;</code></pre></div><!-- Add more clone groups for .txt format as needed         // Add more clone groups for .txt format as needed--></div><a name="typescript-clones"></a><h2 class="text-2xl font-semibold text-gray-700 mb-4">typescript</h2><div class="divide-y divide-gray-200 border-b-2"><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/apps/api/src/routes/pay-webhook.ts (Line 17:2 - Line 30:8), /Users/honk/code/nostrstack/apps/api/src/routes/pay.ts (Line 109:2 - Line 122:3)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn0" onclick="toggleCodeBlock('cloneGroup0', 'expandBtn0', 'collapseBtn0')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn0" onclick="toggleCodeBlock('cloneGroup0', 'expandBtn0', 'collapseBtn0')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup0"><code class="language-typescript text-sm text-gray-800">} });
      let metadata: unknown | undefined;
      if (payment.metadata) {
        try {
          metadata = JSON.parse(payment.metadata) as unknown;
        } catch {
          metadata = undefined;
        }
      }
      const ts = Date.now();
      app.payEventHub?.broadcast({
        type: 'invoice-status',
        ts,
        providerRef: payment</code></pre></div><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/apps/api/src/routes/lnurlp-callback.ts (Line 194:7 - Line 207:17), /Users/honk/code/nostrstack/apps/api/src/routes/pay.ts (Line 110:9 - Line 123:11)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn1" onclick="toggleCodeBlock('cloneGroup1', 'expandBtn1', 'collapseBtn1')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn1" onclick="toggleCodeBlock('cloneGroup1', 'expandBtn1', 'collapseBtn1')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup1"><code class="language-typescript text-sm text-gray-800">let metadata: unknown | undefined;
      if (payment.metadata) {
        try {
          metadata = JSON.parse(payment.metadata) as unknown;
        } catch {
          metadata = undefined;
        }
      }
      const ts = Date.now();
      app.payEventHub?.broadcast({
        type: 'invoice-status',
        ts,
        providerRef: id,
        status: normalizedStatus</code></pre></div><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/apps/api/src/routes/lnurlp-callback.ts (Line 216:11 - Line 226:8), /Users/honk/code/nostrstack/apps/api/src/routes/pay.ts (Line 132:11 - Line 142:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn2" onclick="toggleCodeBlock('cloneGroup2', 'expandBtn2', 'collapseBtn2')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn2" onclick="toggleCodeBlock('cloneGroup2', 'expandBtn2', 'collapseBtn2')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup2"><code class="language-typescript text-sm text-gray-800">)) {
        app.payEventHub?.broadcast({
          type: 'invoice-paid',
          ts,
          pr: payment.invoice,
          providerRef: id,
          amount: payment.amountSats,
          action: payment.action ?? undefined,
          itemId: payment.itemId ?? undefined,
          metadata,
          source: 'lnurl'</code></pre></div><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/apps/api/src/routes/lnurlp-callback.test.ts (Line 1:1 - Line 12:22), /Users/honk/code/nostrstack/apps/api/src/routes/lnurlp-provider.test.ts (Line 1:1 - Line 12:31)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn3" onclick="toggleCodeBlock('cloneGroup3', 'expandBtn3', 'collapseBtn3')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn3" onclick="toggleCodeBlock('cloneGroup3', 'expandBtn3', 'collapseBtn3')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup3"><code class="language-typescript text-sm text-gray-800">import { execSync } from 'node:child_process';
import { resolve } from 'node:path';

import { afterAll,beforeAll, describe, expect, it } from 'vitest';

import type { buildServer as buildServerFn } from '../server.js';

process.env.NODE_ENV = 'test';
process.env.VITEST = 'true';
process.env.LOG_LEVEL = 'error';
process.env.OP_NODE_WEBHOOK_SECRET = '';
process.env.DATABASE_URL = 'file:./tmp-lnurl.db'</code></pre></div><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/apps/api/src/routes/lnurlp-callback.test.ts (Line 16:16 - Line 31:48), /Users/honk/code/nostrstack/apps/api/src/routes/lnurlp-provider.test.ts (Line 17:31 - Line 32:58)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn4" onclick="toggleCodeBlock('cloneGroup4', 'expandBtn4', 'collapseBtn4')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn4" onclick="toggleCodeBlock('cloneGroup4', 'expandBtn4', 'collapseBtn4')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup4"><code class="language-typescript text-sm text-gray-800">, () =&gt; {
  beforeAll(async () =&gt; {
    const schema = resolve(process.cwd(), 'prisma/schema.prisma');
    execSync(`./node_modules/.bin/prisma db push --skip-generate --accept-data-loss --schema ${schema}`, {
      stdio: 'inherit',
      env: { ...process.env, DATABASE_URL: process.env.DATABASE_URL }
    });
    const { buildServer } = await import('../server.js');
    server = await buildServer();
  });

  afterAll(async () =&gt; {
    await server.close();
  });

  it('returns 202 for unknown payment (replay-safe)'</code></pre></div><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/apps/api/src/routes/embed-config.test.ts (Line 20:16 - Line 35:24), /Users/honk/code/nostrstack/apps/api/src/routes/lnurlp-provider.test.ts (Line 17:31 - Line 32:58)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn5" onclick="toggleCodeBlock('cloneGroup5', 'expandBtn5', 'collapseBtn5')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn5" onclick="toggleCodeBlock('cloneGroup5', 'expandBtn5', 'collapseBtn5')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup5"><code class="language-typescript text-sm text-gray-800">, () =&gt; {
  beforeAll(async () =&gt; {
    const schema = resolve(process.cwd(), 'prisma/schema.prisma');
    execSync(`./node_modules/.bin/prisma db push --skip-generate --accept-data-loss --schema ${schema}`, {
      stdio: 'inherit',
      env: { ...process.env, DATABASE_URL: process.env.DATABASE_URL }
    });
    const { buildServer } = await import('../server.js');
    server = await buildServer();
  });

  afterAll(async () =&gt; {
    await server.close();
  });

  it('requires tenant param'</code></pre></div><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/apps/api/src/nostr/nostr.test.ts (Line 4:2 - Line 12:17), /Users/honk/code/nostrstack/apps/api/src/routes/lnurlp-provider.test.ts (Line 4:2 - Line 12:13)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn6" onclick="toggleCodeBlock('cloneGroup6', 'expandBtn6', 'collapseBtn6')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn6" onclick="toggleCodeBlock('cloneGroup6', 'expandBtn6', 'collapseBtn6')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup6"><code class="language-typescript text-sm text-gray-800">} from 'vitest';

import type { buildServer as buildServerFn } from '../server.js';

process.env.NODE_ENV = 'test';
process.env.VITEST = 'true';
process.env.LOG_LEVEL = 'error';
process.env.OP_NODE_WEBHOOK_SECRET = '';
process.env.NOSTR_SECRET_KEY</code></pre></div><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/apps/api/src/nostr/nostr.test.ts (Line 17:8 - Line 28:11), /Users/honk/code/nostrstack/apps/api/src/routes/lnurlp-provider.test.ts (Line 17:31 - Line 28:9)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn7" onclick="toggleCodeBlock('cloneGroup7', 'expandBtn7', 'collapseBtn7')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn7" onclick="toggleCodeBlock('cloneGroup7', 'expandBtn7', 'collapseBtn7')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup7"><code class="language-typescript text-sm text-gray-800">, () =&gt; {
  beforeAll(async () =&gt; {
    const schema = resolve(process.cwd(), 'prisma/schema.prisma');
    execSync(`./node_modules/.bin/prisma db push --skip-generate --accept-data-loss --schema ${schema}`, {
      stdio: 'inherit',
      env: { ...process.env, DATABASE_URL: process.env.DATABASE_URL }
    });
    const { buildServer } = await import('../server.js');
    server = await buildServer();
  });

  beforeEach</code></pre></div><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/packages/embed/src/qr.ts (Line 203:2 - Line 210:6), /Users/honk/code/nostrstack/packages/embed/src/qr.ts (Line 170:2 - Line 177:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn9" onclick="toggleCodeBlock('cloneGroup9', 'expandBtn9', 'collapseBtn9')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn9" onclick="toggleCodeBlock('cloneGroup9', 'expandBtn9', 'collapseBtn9')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup9"><code class="language-typescript text-sm text-gray-800">;
    for (let i = 0; i &lt; imageData.data.length; i += 4) {
      const a = imageData.data[i + 3] ?? 0;
      const r = imageData.data[i] ?? 0;
      const g = imageData.data[i + 1] ?? 0;
      const b = imageData.data[i + 2] ?? 0;
      const lum = a &lt; 20 ? 255 : Math.max(0, Math.min(255, Math.round((r * 299 + g * 587 + b * 114) / 1000)));
      const</code></pre></div><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/packages/embed/src/index.test.ts (Line 46:18 - Line 60:9), /Users/honk/code/nostrstack/packages/embed/src/index.test.ts (Line 18:19 - Line 31:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn10" onclick="toggleCodeBlock('cloneGroup10', 'expandBtn10', 'collapseBtn10')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn10" onclick="toggleCodeBlock('cloneGroup10', 'expandBtn10', 'collapseBtn10')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup10"><code class="language-typescript text-sm text-gray-800">;
    vi.spyOn(globalThis as unknown as { fetch: typeof fetch }, 'fetch').mockResolvedValueOnce({
      ok: true,
      json: async () =&gt; ({ callback: 'http://localhost:3001/api/lnurlp/alice/invoice' })
    } as Response).mockResolvedValueOnce({
      ok: true,
      json: async () =&gt; ({ pr })
    } as Response);

    const write = vi.fn();
    (globalThis.navigator as unknown as { clipboard: { writeText: (s: string) =&gt; Promise&lt;void&gt; | void } }).clipboard = {
      writeText: write
    };

    const onUnlock</code></pre></div><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/packages/embed/src/index.test.ts (Line 104:2 - Line 115:9), /Users/honk/code/nostrstack/packages/embed/src/index.test.ts (Line 53:9 - Line 64:14)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn11" onclick="toggleCodeBlock('cloneGroup11', 'expandBtn11', 'collapseBtn11')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn11" onclick="toggleCodeBlock('cloneGroup11', 'expandBtn11', 'collapseBtn11')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup11"><code class="language-typescript text-sm text-gray-800">);

    const write = vi.fn();
    (globalThis.navigator as unknown as { clipboard: { writeText: (s: string) =&gt; Promise&lt;void&gt; | void } }).clipboard = {
      writeText: write
    };

    const onUnlock = vi.fn();
    const button = mountPayToAction(host, {
      username: 'alice',
      amountSats: 10,
      onUnlock</code></pre></div><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/packages/embed/src/index.test.ts (Line 157:56 - Line 165:6), /Users/honk/code/nostrstack/packages/embed/src/index.test.ts (Line 131:41 - Line 139:15)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn12" onclick="toggleCodeBlock('cloneGroup12', 'expandBtn12', 'collapseBtn12')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn12" onclick="toggleCodeBlock('cloneGroup12', 'expandBtn12', 'collapseBtn12')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup12"><code class="language-typescript text-sm text-gray-800">, async () =&gt; {
    const host = document.createElement('div');
    const write = vi.fn();
    (globalThis.navigator as unknown as { clipboard: { writeText: (s: string) =&gt; Promise&lt;void&gt; | void } }).clipboard =
      {
        writeText: write
      };

    const</code></pre></div><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/apps/gallery/src/useCopyAction.ts (Line 8:22 - Line 17:7), /Users/honk/code/nostrstack/packages/embed/src/copyButton.ts (Line 13:20 - Line 22:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn17" onclick="toggleCodeBlock('cloneGroup17', 'expandBtn17', 'collapseBtn17')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn17" onclick="toggleCodeBlock('cloneGroup17', 'expandBtn17', 'collapseBtn17')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup17"><code class="language-typescript text-sm text-gray-800">(label: string) {
  const trimmed = (label ?? '').trim();
  if (!trimmed) return 'Copied';
  const lower = trimmed.toLowerCase();
  if (lower === 'copy') return 'Copied';
  if (lower.startsWith('copy ')) return `Copied ${trimmed.slice(5)}`;
  return `${trimmed} copied`;
}

export</code></pre></div><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/apps/gallery/src/useCopyAction.ts (Line 55:5 - Line 64:6), /Users/honk/code/nostrstack/packages/embed/src/copyButton.ts (Line 131:2 - Line 140:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn18" onclick="toggleCodeBlock('cloneGroup18', 'expandBtn18', 'collapseBtn18')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn18" onclick="toggleCodeBlock('cloneGroup18', 'expandBtn18', 'collapseBtn18')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup18"><code class="language-typescript text-sm text-gray-800">;
    } catch (err) {
      console.warn('copy failed', err);
      try {
        if (typeof navigator !== 'undefined' &amp;&amp; typeof navigator.vibrate === 'function') navigator.vibrate([15, 25, 15]);
      } catch {
        /* ignore */
      }
      setState('error');
      toast</code></pre></div><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/apps/gallery/scripts/qa-regtest-demo.ts (Line 269:2 - Line 279:4), /Users/honk/code/nostrstack/apps/gallery/tests/demo-flows.spec.ts (Line 6:2 - Line 16:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn54" onclick="toggleCodeBlock('cloneGroup54', 'expandBtn54', 'collapseBtn54')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn54" onclick="toggleCodeBlock('cloneGroup54', 'expandBtn54', 'collapseBtn54')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup54"><code class="language-typescript text-sm text-gray-800">page.evaluate(() =&gt; {
        const paywall = document.querySelector('.nostrstack-paywall') as HTMLElement | null;
        const card = paywall?.closest('section') as HTMLElement | null;
        if (!paywall || !card) return null;
        const cardRect = card.getBoundingClientRect();
        let maxDelta = 0;
        let offender: { tag: string; cls: string; text: string; delta: number } | null = null;
        for (const el of Array.from(card.querySelectorAll('*'))) {
          const rect = (el as HTMLElement).getBoundingClientRect();
          const delta = rect.right - cardRect.right;
          if (delta &gt; maxDelta + 0.5</code></pre></div><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/apps/gallery/scripts/qa-regtest-demo.ts (Line 302:13 - Line 307:13), /Users/honk/code/nostrstack/apps/gallery/scripts/qa-regtest-demo.ts (Line 254:7 - Line 259:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn55" onclick="toggleCodeBlock('cloneGroup55', 'expandBtn55', 'collapseBtn55')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn55" onclick="toggleCodeBlock('cloneGroup55', 'expandBtn55', 'collapseBtn55')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup55"><code class="language-typescript text-sm text-gray-800">).toMatch(/^ln/i);
    await page.evaluate(async (invoice) =&gt; {
      await navigator.clipboard.writeText(invoice);
      const paste = Array.from(document.querySelectorAll('button')).find((b) =&gt; b.textContent?.trim() === 'Paste') as HTMLButtonElement | undefined;
      paste?.click();
    }, bolt11Unlock</code></pre></div><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/apps/gallery/scripts/qa-regtest-demo.ts (Line 329:11 - Line 334:11), /Users/honk/code/nostrstack/apps/gallery/scripts/qa-regtest-demo.ts (Line 254:7 - Line 259:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn56" onclick="toggleCodeBlock('cloneGroup56', 'expandBtn56', 'collapseBtn56')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn56" onclick="toggleCodeBlock('cloneGroup56', 'expandBtn56', 'collapseBtn56')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup56"><code class="language-typescript text-sm text-gray-800">).toMatch(/^ln/i);
    await page.evaluate(async (invoice) =&gt; {
      await navigator.clipboard.writeText(invoice);
      const paste = Array.from(document.querySelectorAll('button')).find((b) =&gt; b.textContent?.trim() === 'Paste') as HTMLButtonElement | undefined;
      paste?.click();
    }, bolt11Real</code></pre></div><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/apps/api/tests/nostr-auth.spec.ts (Line 11:22 - Line 20:6), /Users/honk/code/nostrstack/apps/api/tests/pay-to-act.spec.ts (Line 13:2 - Line 22:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn57" onclick="toggleCodeBlock('cloneGroup57', 'expandBtn57', 'collapseBtn57')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn57" onclick="toggleCodeBlock('cloneGroup57', 'expandBtn57', 'collapseBtn57')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup57"><code class="language-typescript text-sm text-gray-800">;

test.beforeAll(async ({ playwright }) =&gt; {
  test.setTimeout(120_000);
  process.env.NODE_ENV = 'test';
  process.env.VITEST = 'true';
  process.env.ADMIN_API_KEY = process.env.ADMIN_API_KEY ?? 'test-admin';
  process.env.OP_NODE_API_KEY = process.env.OP_NODE_API_KEY ?? 'test-key';
  process.env.OP_NODE_WEBHOOK_SECRET = process.env.OP_NODE_WEBHOOK_SECRET ?? 'whsec_test';
  const</code></pre></div><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/apps/api/tests/nostr-auth.spec.ts (Line 19:13 - Line 46:4), /Users/honk/code/nostrstack/apps/api/tests/pay-to-act.spec.ts (Line 22:7 - Line 49:12)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn58" onclick="toggleCodeBlock('cloneGroup58', 'expandBtn58', 'collapseBtn58')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn58" onclick="toggleCodeBlock('cloneGroup58', 'expandBtn58', 'collapseBtn58')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup58"><code class="language-typescript text-sm text-gray-800">;
  const dbPath = process.env.DATABASE_URL ?? 'postgresql://nostrstack:nostrstack@localhost:5432/nostrstack';
  process.env.DATABASE_URL = dbPath;
  const schema = dbPath.startsWith('postgres') ? 'prisma/pg/schema.prisma' : 'prisma/schema.prisma';
  execSync(`pnpm exec prisma db push --skip-generate --accept-data-loss --schema ${schema}`, {
    stdio: 'inherit',
    env: { ...process.env, DATABASE_URL: process.env.DATABASE_URL }
  });

  const { buildServer } = await import('../src/server.js');
  const server = await buildServer();
  await server.listen({ port: 0, host: '127.0.0.1' });
  const port = server.server.address()?.port;
  const baseUrl = `http://127.0.0.1:${port}`;
  stopServer = async () =&gt; server.close();
  await waitForHealth(`${baseUrl}/health`, 30000, true);

  api = await playwright.request.newContext({
    baseURL: baseUrl,
    extraHTTPHeaders: { host: DOMAIN }
  });

  await api.post('/api/admin/tenants', {
    data: { domain: DOMAIN, displayName: 'Demo Tenant' },
    headers: { 'x-api-key': process.env.ADMIN_API_KEY ?? '' }
  });
  await api.post('/api/admin/users', {
    data: { domain: DOMAIN, lightningAddress: 'demo@demo.nostrstack.lol', pubkey: 'f'</code></pre></div><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/apps/api/tests/lnurlp.spec.ts (Line 10:5 - Line 23:6), /Users/honk/code/nostrstack/apps/api/tests/pay-to-act.spec.ts (Line 13:2 - Line 23:9)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn59" onclick="toggleCodeBlock('cloneGroup59', 'expandBtn59', 'collapseBtn59')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn59" onclick="toggleCodeBlock('cloneGroup59', 'expandBtn59', 'collapseBtn59')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup59"><code class="language-typescript text-sm text-gray-800">;

test.beforeAll(async ({ playwright }) =&gt; {
  test.setTimeout(120_000);
  process.env.NODE_ENV = 'test';
  process.env.VITEST = 'true';
  process.env.ADMIN_API_KEY = process.env.ADMIN_API_KEY ?? 'test-admin';
  process.env.OP_NODE_API_KEY = process.env.OP_NODE_API_KEY ?? 'test-key';
  process.env.OP_NODE_WEBHOOK_SECRET = process.env.OP_NODE_WEBHOOK_SECRET ?? 'whsec_test';
  const dbPath = process.env.DATABASE_URL ?? 'postgresql://nostrstack:nostrstack@localhost:5432/nostrstack';
  process.env.DATABASE_URL = dbPath;
  const schema = dbPath.startsWith('postgres') ? 'prisma/pg/schema.prisma' : 'prisma/schema.prisma';

  const</code></pre></div><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/apps/api/tests/lnurlp.spec.ts (Line 24:8 - Line 36:2), /Users/honk/code/nostrstack/apps/api/tests/pay-to-act.spec.ts (Line 26:2 - Line 37:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn60" onclick="toggleCodeBlock('cloneGroup60', 'expandBtn60', 'collapseBtn60')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn60" onclick="toggleCodeBlock('cloneGroup60', 'expandBtn60', 'collapseBtn60')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup60"><code class="language-typescript text-sm text-gray-800">, {
    stdio: 'inherit',
    env: { ...process.env, DATABASE_URL: process.env.DATABASE_URL }
  });

  const { buildServer } = await import('../src/server.js');
  const server = await buildServer();
  await server.listen({ port: 0, host: '127.0.0.1' });
  const port = server.server.address()?.port;
  const baseUrl = `http://127.0.0.1:${port}`;
  stopServer = async () =&gt; server.close();

  await waitForHealth(`${baseUrl}/health`)</code></pre></div><!-- Add more clone groups for .txt format as needed         // Add more clone groups for .txt format as needed--></div><a name="javascript-clones"></a><h2 class="text-2xl font-semibold text-gray-700 mb-4">javascript</h2><div class="divide-y divide-gray-200 border-b-2"><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/apps/gallery/src/TelemetryCard.tsx (Line 380:88 - Line 406:7), /Users/honk/code/nostrstack/apps/gallery/src/TelemetryCard.tsx (Line 359:89 - Line 388:21)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn19" onclick="toggleCodeBlock('cloneGroup19', 'expandBtn19', 'collapseBtn19')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn19" onclick="toggleCodeBlock('cloneGroup19', 'expandBtn19', 'collapseBtn19')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup19"><code class="language-javascript text-sm text-gray-800"> }}&gt;
            Check API logs (.logs/dev/api.log) and bitcoind RPC health.
          &lt;/span&gt;
        &lt;/div&gt;
      )}
      {status === 'error' &amp;&amp; (
        &lt;div
          style={{
            fontSize: '0.9rem',
            color: 'color-mix(in oklab, var(--nostrstack-color-danger) 70%, var(--nostrstack-color-text))',
            background:
              'color-mix(in oklab, var(--nostrstack-color-danger) 12%, var(--nostrstack-color-surface))',
            border:
              '1px solid color-mix(in oklab, var(--nostrstack-color-danger) 35%, var(--nostrstack-color-border))',
            padding: '0.45rem 0.6rem',
            borderRadius: 'var(--nostrstack-radius-md)',
            display: 'grid',
            gap: 4
          }}
        &gt;
          &lt;span&gt;Stream error: {errorMsg ?? 'disconnected'} — retrying…&lt;/span&gt;
          {suggestFix(activeUrl, errorMsg)?.length ? (
            &lt;span style={{ color: 'color-mix(in oklab, var(--nostrstack-color-danger) 80%, var(--nostrstack-color-text))' }}&gt;
              {suggestFix(activeUrl, errorMsg)}
            &lt;/span&gt;
          ) : null}
          &lt;span style={{ color</code></pre></div><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/apps/gallery/src/ShareWidget.tsx (Line 498:37 - Line 527:17), /Users/honk/code/nostrstack/packages/blog-kit/src/share-widget.tsx (Line 531:3 - Line 555:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn20" onclick="toggleCodeBlock('cloneGroup20', 'expandBtn20', 'collapseBtn20')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn20" onclick="toggleCodeBlock('cloneGroup20', 'expandBtn20', 'collapseBtn20')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup20"><code class="language-javascript text-sm text-gray-800"> }}&gt;
            No shares yet. Be the first.
          &lt;/div&gt;
        )}
      &lt;/div&gt;

      {events.slice(0, 6).length &gt; 0 &amp;&amp; (
        &lt;div style={{ marginTop: 12, display: 'grid', gap: 8 }}&gt;
          {events.slice(0, 6).map((ev) =&gt; {
            const profile = profiles[ev.pubkey];
            const name = profile?.display_name || profile?.name || profile?.nip05 || shortKey(ev.pubkey);
            const pic = profile?.picture;
            const href = `https://njump.me/${ev.id}`;
            return (
              &lt;a
                key={ev.id}
                href={href}
                target=&quot;_blank&quot;
                rel=&quot;noreferrer&quot;
                style={{
                  display: 'flex',
                  gap: 10,
                  alignItems: 'center',
                  padding: '8px 10px',
                  borderRadius: 12,
                  border: '1px solid var(--nostrstack-color-border)',
                  background: 'color-mix(in oklab, var(--nostrstack-color-surface) 90%, white)',
                  textDecoration: 'none',
                  color: 'var(--nostrstack-color-text)'
                </code></pre></div><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/apps/gallery/src/ShareWidget.tsx (Line 526:31 - Line 540:19), /Users/honk/code/nostrstack/packages/blog-kit/src/share-widget.tsx (Line 555:2 - Line 568:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn21" onclick="toggleCodeBlock('cloneGroup21', 'expandBtn21', 'collapseBtn21')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn21" onclick="toggleCodeBlock('cloneGroup21', 'expandBtn21', 'collapseBtn21')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup21"><code class="language-javascript text-sm text-gray-800">
                }}
              &gt;
                &lt;div
                  style={{
                    width: 30,
                    height: 30,
                    borderRadius: 999,
                    overflow: 'hidden',
                    border: '1px solid var(--nostrstack-color-border)',
                    display: 'grid',
                    placeItems: 'center',
                    background: 'var(--nostrstack-color-surface)',
                    flex: '0 0 auto'
                  </code></pre></div><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/apps/gallery/src/ShareWidget.tsx (Line 539:11 - Line 568:11), /Users/honk/code/nostrstack/packages/blog-kit/src/share-widget.tsx (Line 568:2 - Line 601:22)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn22" onclick="toggleCodeBlock('cloneGroup22', 'expandBtn22', 'collapseBtn22')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn22" onclick="toggleCodeBlock('cloneGroup22', 'expandBtn22', 'collapseBtn22')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup22"><code class="language-javascript text-sm text-gray-800">
                  }}
                &gt;
                  {pic ? (
                    &lt;img src={pic} alt=&quot;&quot; style={{ width: '100%', height: '100%', objectFit: 'cover' }} /&gt;
                  ) : (
                    &lt;span style={{ fontSize: 12, fontWeight: 800 }}&gt;
                      {(profile?.display_name || profile?.name || ev.pubkey).slice(0, 1).toUpperCase()}
                    &lt;/span&gt;
                  )}
                &lt;/div&gt;
                &lt;div style={{ minWidth: 0, display: 'grid' }}&gt;
                  &lt;div style={{ fontWeight: 800, overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap' }}&gt;
                    {name}
                  &lt;/div&gt;
                  &lt;div style={{ fontSize: 12, color: 'var(--nostrstack-color-text-muted)' }}&gt;
                    {timeAgo(now, ev.created_at)}
                  &lt;/div&gt;
                &lt;/div&gt;
                &lt;div style={{ marginLeft: 'auto', fontSize: 12, color: 'var(--nostrstack-color-text-muted)' }}&gt;
                  Open
                &lt;/div&gt;
              &lt;/a&gt;
            );
          })}
        &lt;/div&gt;
      )}

      {error &amp;&amp; (
        &lt;div role=&quot;alert&quot; style={{ marginTop</code></pre></div><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/apps/gallery/src/RelayCard.tsx (Line 345:6 - Line 362:2), /Users/honk/code/nostrstack/apps/gallery/src/comments/CommentsPanel.tsx (Line 317:5 - Line 335:9)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn44" onclick="toggleCodeBlock('cloneGroup44', 'expandBtn44', 'collapseBtn44')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn44" onclick="toggleCodeBlock('cloneGroup44', 'expandBtn44', 'collapseBtn44')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup44"><code class="language-javascript text-sm text-gray-800">)}
                className=&quot;nostrstack-btn nostrstack-btn--sm nostrstack-btn--ghost&quot;
                style={{ borderRadius: 'var(--nostrstack-radius-pill)', padding: '0.25rem 0.6rem' }}
                aria-label=&quot;Close relay event details&quot;
              &gt;
                ×
              &lt;/button&gt;
            &lt;/div&gt;

            &lt;div style={{ display: 'grid', gap: '0.75rem' }}&gt;
              &lt;div style={{ display: 'grid', gap: 6 }}&gt;
                &lt;strong style={{ color: 'var(--nostrstack-color-text)' }}&gt;{lastEvent.label}&lt;/strong&gt;
                {lastEvent.sublabel ? (
                  &lt;div style={{ color: 'var(--nostrstack-color-text-muted)' }}&gt;{lastEvent.sublabel}&lt;/div&gt;
                ) : null}
              &lt;/div&gt;

              &lt;div style={{</code></pre></div><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/apps/gallery/src/NostrProfileCard.tsx (Line 272:2 - Line 309:2), /Users/honk/code/nostrstack/apps/gallery/src/NostrProfileCard.tsx (Line 231:12 - Line 271:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn47" onclick="toggleCodeBlock('cloneGroup47', 'expandBtn47', 'collapseBtn47')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn47" onclick="toggleCodeBlock('cloneGroup47', 'expandBtn47', 'collapseBtn47')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup47"><code class="language-javascript text-sm text-gray-800">}&gt;Profile details&lt;/div&gt;
        &lt;div&gt;Profile fetch failed.&lt;/div&gt;
      &lt;/div&gt;
    );
  }
  if (!fullProfile) {
    return (
      &lt;div style={{ border: '1px solid var(--nostrstack-color-border)', borderRadius: 'var(--nostrstack-radius-lg)', padding: '0.55rem 0.7rem', background: 'var(--nostrstack-color-surface)', color: 'var(--nostrstack-color-text-muted)' }}&gt;
        &lt;div style={{ fontWeight: 700, marginBottom: '0.35rem', color: 'var(--nostrstack-color-text)' }}&gt;Profile details&lt;/div&gt;
        &lt;div&gt;Connect a signer to load profile metadata.&lt;/div&gt;
      &lt;/div&gt;
    );
  }
  const rowsRaw: Array&lt;[string, unknown]&gt; = [
    ['Display name', fullProfile.display_name],
    ['Name', fullProfile.name],
    ['NIP-05', fullProfile.nip05],
    ['Lightning', fullProfile.lud16],
    ['LNURL (lud06)', fullProfile.lud06],
    ['Website', fullProfile.website],
    ['Picture', fullProfile.picture],
    ['Banner', fullProfile.banner],
    ['About', fullProfile.about],
    ['Updated', metaEvent?.created_at ? new Date(metaEvent.created_at * 1000).toLocaleString() : undefined],
    ['Event id', metaEvent?.id],
    ['Relay', metaRelay]
  ];
  const rows = rowsRaw.filter(([, v]) =&gt; Boolean(v));
  if (!rows.length) {
    return (
      &lt;div style={{ border: '1px solid var(--nostrstack-color-border)', borderRadius: 'var(--nostrstack-radius-lg)', padding: '0.55rem 0.7rem', background: 'var(--nostrstack-color-surface)', color: 'var(--nostrstack-color-text-muted)' }}&gt;
        &lt;div style={{ fontWeight: 700, marginBottom: '0.35rem', color: 'var(--nostrstack-color-text)' }}&gt;Profile details&lt;/div&gt;
        &lt;div&gt;No profile metadata available.&lt;/div&gt;
      &lt;/div&gt;
    );
  }
  return (
    &lt;div style={{ border: '1px solid var(--nostrstack-color-border)', borderRadius: 'var(--nostrstack-radius-lg)', padding: '0.55rem 0.7rem', background: 'var(--nostrstack-color-surface)' </code></pre></div><!-- Add more clone groups for .txt format as needed         // Add more clone groups for .txt format as needed--></div><a name="tsx-clones"></a><h2 class="text-2xl font-semibold text-gray-700 mb-4">tsx</h2><div class="divide-y divide-gray-200 border-b-2"><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/packages/blog-kit/src/tip-activity-feed.tsx (Line 25:7 - Line 35:13), /Users/honk/code/nostrstack/packages/blog-kit/src/tip-widget.tsx (Line 47:7 - Line 57:15)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn13" onclick="toggleCodeBlock('cloneGroup13', 'expandBtn13', 'collapseBtn13')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn13" onclick="toggleCodeBlock('cloneGroup13', 'expandBtn13', 'collapseBtn13')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup13"><code class="language-tsx text-sm text-gray-800">host: host ?? parsed?.domain ?? cfg.host,
      baseUrl: baseUrl ?? cfg.baseUrl,
    };
  }, [lnAddress, baseUrl, host, cfg.lnAddress, cfg.baseUrl, cfg.host]);

  useEffect(() =&gt; {
    const node = ref.current;
    if (!node) return;
    node.innerHTML = '';

    const handle = mountTipFeed</code></pre></div><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/packages/blog-kit/src/share-button.tsx (Line 4:2 - Line 24:6), /Users/honk/code/nostrstack/packages/blog-kit/src/share-widget.tsx (Line 4:2 - Line 24:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn14" onclick="toggleCodeBlock('cloneGroup14', 'expandBtn14', 'collapseBtn14')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn14" onclick="toggleCodeBlock('cloneGroup14', 'expandBtn14', 'collapseBtn14')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup14"><code class="language-tsx text-sm text-gray-800">} from 'nostr-tools/relay';
import React, { useCallback, useEffect, useMemo, useRef, useState } from 'react';

import { useNostrstackConfig } from './context';

const DEFAULT_RELAYS = ['wss://relay.damus.io', 'wss://relay.snort.social'];

type UnsignedEvent = {
  kind: number;
  created_at: number;
  tags: string[][];
  content: string;
  pubkey: string;
};

type SignedEvent = UnsignedEvent &amp; {
  id: string;
  sig: string;
};

async</code></pre></div><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/packages/blog-kit/src/share-button.tsx (Line 24:1 - Line 33:12), /Users/honk/code/nostrstack/packages/blog-kit/src/share-widget.tsx (Line 64:1 - Line 73:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn15" onclick="toggleCodeBlock('cloneGroup15', 'expandBtn15', 'collapseBtn15')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn15" onclick="toggleCodeBlock('cloneGroup15', 'expandBtn15', 'collapseBtn15')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup15"><code class="language-tsx text-sm text-gray-800">async function publishToRelays(relays: string[], event: SignedEvent) {
  const connections: Relay[] = [];
  try {
    for (const url of relays) {
      const relay = await Relay.connect(url);
      connections.push(relay);
      await relay.publish(event);
    }
  } finally {
    connections</code></pre></div><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/packages/blog-kit/src/share-button.tsx (Line 33:2 - Line 47:17), /Users/honk/code/nostrstack/packages/blog-kit/src/share-widget.tsx (Line 88:2 - Line 102:17)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn16" onclick="toggleCodeBlock('cloneGroup16', 'expandBtn16', 'collapseBtn16')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn16" onclick="toggleCodeBlock('cloneGroup16', 'expandBtn16', 'collapseBtn16')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup16"><code class="language-tsx text-sm text-gray-800">);
  }
}

async function copyText(text: string) {
  try {
    if (navigator?.clipboard?.writeText) {
      await navigator.clipboard.writeText(text);
    }
  } catch (error) {
    console.warn('clipboard copy failed', error);
  }
}

export type ShareButtonProps</code></pre></div><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/apps/gallery/src/ShareWidget.tsx (Line 4:11 - Line 21:5), /Users/honk/code/nostrstack/packages/blog-kit/src/share-widget.tsx (Line 9:2 - Line 26:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn23" onclick="toggleCodeBlock('cloneGroup23', 'expandBtn23', 'collapseBtn23')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn23" onclick="toggleCodeBlock('cloneGroup23', 'expandBtn23', 'collapseBtn23')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup23"><code class="language-tsx text-sm text-gray-800">;

type UnsignedEvent = {
  kind: number;
  created_at: number;
  tags: string[][];
  content: string;
  pubkey: string;
};

type SignedEvent = UnsignedEvent &amp; {
  id: string;
  sig: string;
};

type ShareEvent = Pick&lt;SignedEvent, 'id' | 'pubkey' | 'created_at' | 'content' | 'tags'&gt;;

type</code></pre></div><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/apps/gallery/src/ShareWidget.tsx (Line 21:1 - Line 56:2), /Users/honk/code/nostrstack/packages/blog-kit/src/share-widget.tsx (Line 26:2 - Line 60:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn24" onclick="toggleCodeBlock('cloneGroup24', 'expandBtn24', 'collapseBtn24')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn24" onclick="toggleCodeBlock('cloneGroup24', 'expandBtn24', 'collapseBtn24')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup24"><code class="language-tsx text-sm text-gray-800">type NostrProfile = {
  pubkey: string;
  name?: string;
  display_name?: string;
  picture?: string;
  nip05?: string;
  about?: string;
};

function shortKey(pk?: string) {
  return pk ? `${pk.slice(0, 8)}…${pk.slice(-6)}` : 'nostr user';
}

function timeAgo(nowMs: number, createdAtSec: number) {
  const ageSec = Math.max(0, Math.floor(nowMs / 1000) - createdAtSec);
  if (ageSec &lt; 10) return 'just now';
  if (ageSec &lt; 60) return `${ageSec}s ago`;
  const ageMin = Math.floor(ageSec / 60);
  if (ageMin &lt; 60) return `${ageMin}m ago`;
  const ageHr = Math.floor(ageMin / 60);
  if (ageHr &lt; 48) return `${ageHr}h ago`;
  const ageDay = Math.floor(ageHr / 24);
  return `${ageDay}d ago`;
}

function parseProfile(pubkey: string, raw: unknown): NostrProfile | null {
  if (!raw || typeof raw !== 'object') return null;
  const rec = raw as Record&lt;string, unknown&gt;;
  return {
    pubkey,
    name: typeof rec.name === 'string' ? rec.name : undefined,
    display_name: typeof rec.display_name === 'string' ? rec.display_name : undefined,
    picture: typeof rec.picture === 'string' ? rec.picture : undefined,
    nip05: typeof rec.nip05 === 'string' ? rec.nip05 : undefined,
    about: typeof rec.about === 'string' ? rec.about : undefined
  }</code></pre></div><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/apps/gallery/src/ShareWidget.tsx (Line 56:3 - Line 69:7), /Users/honk/code/nostrstack/packages/blog-kit/src/share-widget.tsx (Line 61:3 - Line 74:11)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn25" onclick="toggleCodeBlock('cloneGroup25', 'expandBtn25', 'collapseBtn25')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn25" onclick="toggleCodeBlock('cloneGroup25', 'expandBtn25', 'collapseBtn25')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup25"><code class="language-tsx text-sm text-gray-800">};
}

async function publishToRelays(relays: string[], event: SignedEvent) {
  const connections: Relay[] = [];
  try {
    for (const url of relays) {
      const relay = await Relay.connect(url);
      connections.push(relay);
      await relay.publish(event);
    }
  } finally {
    const toClose = connections.slice();
    window</code></pre></div><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/apps/gallery/src/ShareWidget.tsx (Line 69:7 - Line 92:2), /Users/honk/code/nostrstack/packages/blog-kit/src/share-widget.tsx (Line 74:11 - Line 97:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn26" onclick="toggleCodeBlock('cloneGroup26', 'expandBtn26', 'collapseBtn26')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn26" onclick="toggleCodeBlock('cloneGroup26', 'expandBtn26', 'collapseBtn26')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup26"><code class="language-tsx text-sm text-gray-800">.setTimeout(() =&gt; {
      toClose.forEach((r) =&gt; {
        try {
          // eslint-disable-next-line @typescript-eslint/no-explicit-any
          (r as any)._connected = false;
        } catch {
          // ignore
        }
        try {
          r.close();
        } catch {
          // ignore
        }
      });
    }, 0);
  }
}

async function copyText(text: string) {
  try {
    if (navigator?.clipboard?.writeText) {
      await navigator.clipboard.writeText(text);
    }
  } catch {</code></pre></div><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/apps/gallery/src/ShareWidget.tsx (Line 113:7 - Line 120:10), /Users/honk/code/nostrstack/packages/blog-kit/src/share-widget.tsx (Line 130:8 - Line 137:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn27" onclick="toggleCodeBlock('cloneGroup27', 'expandBtn27', 'collapseBtn27')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn27" onclick="toggleCodeBlock('cloneGroup27', 'expandBtn27', 'collapseBtn27')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup27"><code class="language-tsx text-sm text-gray-800">&gt;('idle');
  const [shareState, setShareState] = useState&lt;'idle' | 'sharing' | 'shared' | 'error'&gt;('idle');
  const [error, setError] = useState&lt;string | null&gt;(null);
  const [events, setEvents] = useState&lt;ShareEvent[]&gt;([]);
  const [profiles, setProfiles] = useState&lt;Record&lt;string, NostrProfile&gt;&gt;({});
  const profilesRef = useRef&lt;Record&lt;string, NostrProfile&gt;&gt;({});

  useEffect</code></pre></div><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/apps/gallery/src/ShareWidget.tsx (Line 131:13 - Line 144:15), /Users/honk/code/nostrstack/packages/blog-kit/src/share-widget.tsx (Line 160:2 - Line 173:14)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn28" onclick="toggleCodeBlock('cloneGroup28', 'expandBtn28', 'collapseBtn28')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn28" onclick="toggleCodeBlock('cloneGroup28', 'expandBtn28', 'collapseBtn28')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup28"><code class="language-tsx text-sm text-gray-800">]);

  const uniqueSharers = useMemo(() =&gt; {
    const set = new Set&lt;string&gt;();
    for (const ev of events) set.add(ev.pubkey);
    return Array.from(set);
  }, [events]);

  const countLabel = useMemo(() =&gt; {
    if (events.length &gt;= maxItems) return `${maxItems}+`;
    return String(events.length);
  }, [events.length, maxItems]);

  const hydrateProfile</code></pre></div><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/apps/gallery/src/ShareWidget.tsx (Line 142:9 - Line 149:2), /Users/honk/code/nostrstack/packages/blog-kit/src/share-widget.tsx (Line 173:14 - Line 180:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn29" onclick="toggleCodeBlock('cloneGroup29', 'expandBtn29', 'collapseBtn29')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn29" onclick="toggleCodeBlock('cloneGroup29', 'expandBtn29', 'collapseBtn29')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup29"><code class="language-tsx text-sm text-gray-800">]);

  const hydrateProfile = useCallback((pubkey: string, content: string) =&gt; {
    try {
      const raw = JSON.parse(content) as unknown;
      const parsed = parseProfile(pubkey, raw);
      if (!parsed) return;
      setProfiles((prev) =&gt; ({</code></pre></div><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/apps/gallery/src/ShareWidget.tsx (Line 162:5 - Line 179:93), /Users/honk/code/nostrstack/packages/blog-kit/src/share-widget.tsx (Line 187:5 - Line 204:3)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn30" onclick="toggleCodeBlock('cloneGroup30', 'expandBtn30', 'collapseBtn30')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn30" onclick="toggleCodeBlock('cloneGroup30', 'expandBtn30', 'collapseBtn30')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup30"><code class="language-tsx text-sm text-gray-800">if (!relayTargets.length) {
      setStatus('error');
      setError('No relays configured.');
      return;
    }

    let cancelled = false;
    let connections: Relay[] = [];
    let shareSub: Subscription[] = [];
    const profileFetchInFlight = new Set&lt;string&gt;();
    let closeTimer: number | null = null;

    const closeAll = () =&gt; {
      shareSub = [];
      const toClose = connections;
      connections = [];

      // React can unmount/mount components within the same click handler task. `nostr-tools` uses</code></pre></div><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/apps/gallery/src/ShareWidget.tsx (Line 191:13 - Line 214:7), /Users/honk/code/nostrstack/packages/blog-kit/src/share-widget.tsx (Line 211:13 - Line 234:11)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn31" onclick="toggleCodeBlock('cloneGroup31', 'expandBtn31', 'collapseBtn31')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn31" onclick="toggleCodeBlock('cloneGroup31', 'expandBtn31', 'collapseBtn31')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup31"><code class="language-tsx text-sm text-gray-800">// eslint-disable-next-line @typescript-eslint/no-explicit-any
            (c as any)._connected = false;
          } catch {
            // ignore
          }
          try {
            c.close();
          } catch {
            // ignore
          }
        });
      }, 0);
    };

    const connect = async () =&gt; {
      setStatus('connecting');
      setError(null);
      try {
        const results = await Promise.allSettled(relayTargets.map((r) =&gt; Relay.connect(r)));
        const ok = results
          .filter((r): r is PromiseFulfilledResult&lt;Relay&gt; =&gt; r.status === 'fulfilled')
          .map((r) =&gt; r.value);
        if (cancelled) {
          window</code></pre></div><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/apps/gallery/src/ShareWidget.tsx (Line 214:7 - Line 242:2), /Users/honk/code/nostrstack/packages/blog-kit/src/share-widget.tsx (Line 234:11 - Line 262:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn32" onclick="toggleCodeBlock('cloneGroup32', 'expandBtn32', 'collapseBtn32')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn32" onclick="toggleCodeBlock('cloneGroup32', 'expandBtn32', 'collapseBtn32')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup32"><code class="language-tsx text-sm text-gray-800">.setTimeout(() =&gt; {
            ok.forEach((r) =&gt; {
              try {
                // eslint-disable-next-line @typescript-eslint/no-explicit-any
                (r as any)._connected = false;
              } catch {
                // ignore
              }
              try {
                r.close();
              } catch {
                // ignore
              }
            });
          }, 0);
          return;
        }
        connections = ok;
        if (!connections.length) {
          setStatus('error');
          setError('No relays reachable.');
          return;
        }
        setStatus('connected');

        const filters = [
          { kinds: [1], '#r': [url], limit: Math.min(500, Math.max(1, maxItems)) },
          { kinds: [1], '#t': [effectiveTag], limit: Math.min(500, Math.max(1, maxItems)) }
        ]</code></pre></div><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/apps/gallery/src/ShareWidget.tsx (Line 242:9 - Line 257:2), /Users/honk/code/nostrstack/packages/blog-kit/src/share-widget.tsx (Line 263:9 - Line 277:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn33" onclick="toggleCodeBlock('cloneGroup33', 'expandBtn33', 'collapseBtn33')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn33" onclick="toggleCodeBlock('cloneGroup33', 'expandBtn33', 'collapseBtn33')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup33"><code class="language-tsx text-sm text-gray-800">];

        shareSub = connections.map((relay) =&gt;
          relay.subscribe(filters, {
            onevent: (ev: SignedEvent) =&gt; {
              if (cancelled) return;
              if (!ev?.id || typeof ev.id !== 'string') return;
              if (!ev.pubkey || typeof ev.pubkey !== 'string') return;
              if (!ev.created_at || typeof ev.created_at !== 'number') return;
              const next: ShareEvent = {
                id: ev.id,
                pubkey: ev.pubkey,
                created_at: ev.created_at,
                content: ev.content ?? '',
                tags: Array.isArray(ev.tags) ? ev.tags : []
              }</code></pre></div><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/apps/gallery/src/ShareWidget.tsx (Line 257:15 - Line 274:2), /Users/honk/code/nostrstack/packages/blog-kit/src/share-widget.tsx (Line 278:15 - Line 295:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn34" onclick="toggleCodeBlock('cloneGroup34', 'expandBtn34', 'collapseBtn34')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn34" onclick="toggleCodeBlock('cloneGroup34', 'expandBtn34', 'collapseBtn34')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup34"><code class="language-tsx text-sm text-gray-800">};
              setEvents((prev) =&gt; {
                if (prev.some((p) =&gt; p.id === next.id)) return prev;
                const merged = [next, ...prev].sort((a, b) =&gt; b.created_at - a.created_at);
                return merged.slice(0, maxItems);
              });

              if (!profilesRef.current[ev.pubkey] &amp;&amp; !profileFetchInFlight.has(ev.pubkey)) {
                profileFetchInFlight.add(ev.pubkey);
                const subs: Subscription[] = [];
                for (const r of connections) {
                  subs.push(
                    r.subscribe([{ kinds: [0], authors: [ev.pubkey], limit: 1 }], {
                      onevent: (meta: SignedEvent) =&gt; {
                        if (cancelled) return;
                        hydrateProfile(ev.pubkey, meta.content ?? '');
                        profileFetchInFlight.delete(ev.pubkey);
                        subs.forEach((s) =&gt; {</code></pre></div><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/apps/gallery/src/ShareWidget.tsx (Line 291:9 - Line 304:2), /Users/honk/code/nostrstack/packages/blog-kit/src/share-widget.tsx (Line 307:9 - Line 320:56)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn35" onclick="toggleCodeBlock('cloneGroup35', 'expandBtn35', 'collapseBtn35')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn35" onclick="toggleCodeBlock('cloneGroup35', 'expandBtn35', 'collapseBtn35')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup35"><code class="language-tsx text-sm text-gray-800">);
      } catch (err) {
        setStatus('error');
        setError(err instanceof Error ? err.message : 'Failed to connect to relays');
        closeAll();
      }
    };

    connect();
    return () =&gt; {
      cancelled = true;
      closeAll();
    };
  }</code></pre></div><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/apps/gallery/src/ShareWidget.tsx (Line 310:2 - Line 320:4), /Users/honk/code/nostrstack/packages/blog-kit/src/share-widget.tsx (Line 327:2 - Line 336:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn36" onclick="toggleCodeBlock('cloneGroup36', 'expandBtn36', 'collapseBtn36')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn36" onclick="toggleCodeBlock('cloneGroup36', 'expandBtn36', 'collapseBtn36')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup36"><code class="language-tsx text-sm text-gray-800">as unknown as {
        nostr?: {
          getPublicKey: () =&gt; Promise&lt;string&gt;;
          signEvent: (ev: UnsignedEvent) =&gt; Promise&lt;SignedEvent&gt;;
        };
      }
    ).nostr;

    const tags: string[][] = [['r', url], ['t', effectiveTag]];

    try</code></pre></div><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/apps/gallery/src/ShareWidget.tsx (Line 331:9 - Line 342:2), /Users/honk/code/nostrstack/packages/blog-kit/src/share-widget.tsx (Line 354:2 - Line 364:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn37" onclick="toggleCodeBlock('cloneGroup37', 'expandBtn37', 'collapseBtn37')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn37" onclick="toggleCodeBlock('cloneGroup37', 'expandBtn37', 'collapseBtn37')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup37"><code class="language-tsx text-sm text-gray-800">);
        await publishToRelays(relayTargets, signed);
        setShareState('shared');
        setEvents((prev) =&gt; {
          if (prev.some((p) =&gt; p.id === signed.id)) return prev;
          const next: ShareEvent = {
            id: signed.id,
            pubkey: signed.pubkey,
            created_at: signed.created_at,
            content: signed.content,
            tags: signed.tags
          }</code></pre></div><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/apps/gallery/src/ShareWidget.tsx (Line 342:11 - Line 362:14), /Users/honk/code/nostrstack/packages/blog-kit/src/share-widget.tsx (Line 365:11 - Line 385:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn38" onclick="toggleCodeBlock('cloneGroup38', 'expandBtn38', 'collapseBtn38')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn38" onclick="toggleCodeBlock('cloneGroup38', 'expandBtn38', 'collapseBtn38')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup38"><code class="language-tsx text-sm text-gray-800">};
          return [next, ...prev].sort((a, b) =&gt; b.created_at - a.created_at).slice(0, maxItems);
        });
        return;
      }

      if (navigator?.share) {
        await navigator.share({ title, text: note, url });
        setShareState('shared');
        return;
      }

      await copyText(note);
      setShareState('shared');
    } catch (err) {
      setError(err instanceof Error ? err.message : 'Share failed');
      setShareState('error');
    }
  }, [effectiveTag, maxItems, note, relayTargets, title, url]);

  const avatarPubkeys</code></pre></div><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/apps/gallery/src/ShareWidget.tsx (Line 375:7 - Line 386:13), /Users/honk/code/nostrstack/packages/blog-kit/src/share-widget.tsx (Line 386:5 - Line 397:11)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn39" onclick="toggleCodeBlock('cloneGroup39', 'expandBtn39', 'collapseBtn39')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn39" onclick="toggleCodeBlock('cloneGroup39', 'expandBtn39', 'collapseBtn39')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup39"><code class="language-tsx text-sm text-gray-800">&lt;div style={{ display: 'flex', justifyContent: 'space-between', gap: 10, flexWrap: 'wrap' }}&gt;
        &lt;div style={{ display: 'grid', gap: 2 }}&gt;
          &lt;div style={{ fontWeight: 800 }}&gt;Shares&lt;/div&gt;
          &lt;div style={{ fontSize: 13, color: 'var(--nostrstack-color-text-muted)' }}&gt;
            &lt;strong style={{ color: 'var(--nostrstack-color-text)' }}&gt;{countLabel}&lt;/strong&gt;{' '}
            {Number(countLabel.replace('+', '')) === 1 ? 'share' : 'shares'}
            {uniqueSharers.length ? ` · ${uniqueSharers.length} people` : ''}
          &lt;/div&gt;
        &lt;/div&gt;
        &lt;div style={{ display: 'flex', alignItems: 'center', gap: 8, flexWrap: 'wrap' }}&gt;
          &lt;span
            </code></pre></div><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/apps/gallery/src/ShareWidget.tsx (Line 444:7 - Line 452:17), /Users/honk/code/nostrstack/packages/blog-kit/src/share-widget.tsx (Line 452:5 - Line 460:15)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn40" onclick="toggleCodeBlock('cloneGroup40', 'expandBtn40', 'collapseBtn40')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn40" onclick="toggleCodeBlock('cloneGroup40', 'expandBtn40', 'collapseBtn40')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup40"><code class="language-tsx text-sm text-gray-800">&lt;div style={{ marginTop: 10, display: 'flex', alignItems: 'center', gap: 8, flexWrap: 'wrap' }}&gt;
        &lt;div style={{ display: 'flex', alignItems: 'center' }}&gt;
          {avatarPubkeys.map((pk, idx) =&gt; {
            const profile = profiles[pk];
            const label = profile?.display_name || profile?.name || profile?.nip05 || shortKey(pk);
            const pic = profile?.picture;
            return (
              &lt;div
                </code></pre></div><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/apps/gallery/src/ShareWidget.tsx (Line 466:15 - Line 479:15), /Users/honk/code/nostrstack/packages/blog-kit/src/share-widget.tsx (Line 475:13 - Line 488:13)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn41" onclick="toggleCodeBlock('cloneGroup41', 'expandBtn41', 'collapseBtn41')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn41" onclick="toggleCodeBlock('cloneGroup41', 'expandBtn41', 'collapseBtn41')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup41"><code class="language-tsx text-sm text-gray-800">&gt;
                {pic ? (
                  &lt;img src={pic} alt=&quot;&quot; style={{ width: '100%', height: '100%', objectFit: 'cover' }} /&gt;
                ) : (
                  &lt;span style={{ fontSize: 12, fontWeight: 800 }}&gt;
                    {(profile?.display_name || profile?.name || pk).slice(0, 1).toUpperCase()}
                  &lt;/span&gt;
                )}
              &lt;/div&gt;
            );
          })}
          {uniqueSharers.length &gt; avatarPubkeys.length &amp;&amp; (
            &lt;div
              </code></pre></div><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/apps/gallery/src/ShareWidget.tsx (Line 506:2 - Line 541:17), /Users/honk/code/nostrstack/packages/blog-kit/src/share-widget.tsx (Line 535:7 - Line 570:19)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn42" onclick="toggleCodeBlock('cloneGroup42', 'expandBtn42', 'collapseBtn42')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn42" onclick="toggleCodeBlock('cloneGroup42', 'expandBtn42', 'collapseBtn42')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup42"><code class="language-tsx text-sm text-gray-800">.map((ev) =&gt; {
            const profile = profiles[ev.pubkey];
            const name = profile?.display_name || profile?.name || profile?.nip05 || shortKey(ev.pubkey);
            const pic = profile?.picture;
            const href = `https://njump.me/${ev.id}`;
            return (
              &lt;a
                key={ev.id}
                href={href}
                target=&quot;_blank&quot;
                rel=&quot;noreferrer&quot;
                style={{
                  display: 'flex',
                  gap: 10,
                  alignItems: 'center',
                  padding: '8px 10px',
                  borderRadius: 12,
                  border: '1px solid var(--nostrstack-color-border)',
                  background: 'color-mix(in oklab, var(--nostrstack-color-surface) 90%, white)',
                  textDecoration: 'none',
                  color: 'var(--nostrstack-color-text)'
                }}
              &gt;
                &lt;div
                  style={{
                    width: 30,
                    height: 30,
                    borderRadius: 999,
                    overflow: 'hidden',
                    border: '1px solid var(--nostrstack-color-border)',
                    display: 'grid',
                    placeItems: 'center',
                    background: 'var(--nostrstack-color-surface)',
                    flex: '0 0 auto'
                  }}
                </code></pre></div><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/apps/gallery/src/ShareWidget.tsx (Line 540:2 - Line 555:4), /Users/honk/code/nostrstack/packages/blog-kit/src/share-widget.tsx (Line 570:2 - Line 585:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn43" onclick="toggleCodeBlock('cloneGroup43', 'expandBtn43', 'collapseBtn43')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn43" onclick="toggleCodeBlock('cloneGroup43', 'expandBtn43', 'collapseBtn43')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup43"><code class="language-tsx text-sm text-gray-800">
                &gt;
                  {pic ? (
                    &lt;img src={pic} alt=&quot;&quot; style={{ width: '100%', height: '100%', objectFit: 'cover' }} /&gt;
                  ) : (
                    &lt;span style={{ fontSize: 12, fontWeight: 800 }}&gt;
                      {(profile?.display_name || profile?.name || ev.pubkey).slice(0, 1).toUpperCase()}
                    &lt;/span&gt;
                  )}
                &lt;/div&gt;
                &lt;div style={{ minWidth: 0, display: 'grid' }}&gt;
                  &lt;div style={{ fontWeight: 800, overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap' }}&gt;
                    {name}
                  &lt;/div&gt;
                  &lt;div style={{ fontSize: 12, color: 'var(--nostrstack-color-text-muted)' }}&gt;
                    {timeAgo(now</code></pre></div><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/apps/gallery/src/RelayCard.tsx (Line 471:12 - Line 485:7), /Users/honk/code/nostrstack/apps/gallery/src/RelayCard.tsx (Line 450:17 - Line 464:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn45" onclick="toggleCodeBlock('cloneGroup45', 'expandBtn45', 'collapseBtn45')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn45" onclick="toggleCodeBlock('cloneGroup45', 'expandBtn45', 'collapseBtn45')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup45"><code class="language-tsx text-sm text-gray-800">() {
  return (
    &lt;svg
      viewBox=&quot;0 0 24 24&quot;
      width=&quot;18&quot;
      height=&quot;18&quot;
      fill=&quot;none&quot;
      stroke=&quot;currentColor&quot;
      strokeWidth=&quot;2.25&quot;
      strokeLinecap=&quot;round&quot;
      strokeLinejoin=&quot;round&quot;
      focusable=&quot;false&quot;
      aria-hidden=&quot;true&quot;
    &gt;
      &lt;circle</code></pre></div><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/apps/gallery/src/PayToUnlockCard.tsx (Line 159:7 - Line 173:4), /Users/honk/code/nostrstack/apps/gallery/src/WalletBalance.tsx (Line 93:7 - Line 107:77)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn46" onclick="toggleCodeBlock('cloneGroup46', 'expandBtn46', 'collapseBtn46')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn46" onclick="toggleCodeBlock('cloneGroup46', 'expandBtn46', 'collapseBtn46')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup46"><code class="language-tsx text-sm text-gray-800">if (ws.readyState === WebSocket.CONNECTING) {
        const pending = ws;
        pending.onopen = () =&gt; {
          try {
            if (pending.readyState === WebSocket.OPEN) pending.close();
          } catch {
            /* ignore */
          }
        };
        pending.onmessage = null;
        pending.onerror = null;
        pending.onclose = null;
        return;
      }
      try</code></pre></div><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/apps/gallery/src/NostrProfileCard.tsx (Line 196:2 - Line 236:3), /Users/honk/code/nostrstack/apps/gallery/src/comments/CommentsPanel.tsx (Line 132:2 - Line 172:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn48" onclick="toggleCodeBlock('cloneGroup48', 'expandBtn48', 'collapseBtn48')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn48" onclick="toggleCodeBlock('cloneGroup48', 'expandBtn48', 'collapseBtn48')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup48"><code class="language-tsx text-sm text-gray-800">;
          return (
            &lt;RelayCard
              key={r}
              url={r}
              meta={{
                name: stat?.name,
                software: stat?.software,
                version: stat?.version,
                description: stat?.description,
                icon: stat?.icon,
                supportedNips: stat?.supportedNips,
                paymentRequired: stat?.paymentRequired,
                authRequired: stat?.authRequired,
                contact: stat?.contact,
                pubkey: stat?.pubkey,
                paymentsUrl: stat?.paymentsUrl,
                language: stat?.language,
                tags: stat?.tags,
                limitation: stat?.limitation
              }}
              recv={stat?.recv ?? 0}
              recvPerMin={stat?.recvPerMin}
              recvHistory={stat?.recvHistory}
              send={stat?.send ?? 0}
              sendPerMin={stat?.sendPerMin}
              sendHistory={stat?.sendHistory}
              errorCount={stat?.errorCount ?? 0}
              lastError={stat?.lastError}
              sendStatus={stat?.sendStatus}
              last={stat?.last}
              lastSentAt={stat?.lastSentAt}
              lastEvent={stat?.lastEvent}
              latencyMs={stat?.latencyMs}
              online={stat?.online}
              lastProbeAt={stat?.lastProbeAt}
            /&gt;
          );
        })}
      &lt;/div&gt;
    &lt;/</code></pre></div><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/apps/gallery/src/LogViewer.tsx (Line 103:14 - Line 108:14), /Users/honk/code/nostrstack/apps/gallery/src/LogViewer.tsx (Line 93:13 - Line 98:13)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn49" onclick="toggleCodeBlock('cloneGroup49', 'expandBtn49', 'collapseBtn49')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn49" onclick="toggleCodeBlock('cloneGroup49', 'expandBtn49', 'collapseBtn49')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup49"><code class="language-tsx text-sm text-gray-800">.filter((l) =&gt; {
      if (minLevel !== 'all' &amp;&amp; levelRank(l.level) &lt; min) return false;
      if (!f) return true;
      return l.message.toLowerCase().includes(f);
    });
  }, [frontendLines</code></pre></div><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/apps/gallery/src/LogViewer.tsx (Line 321:19 - Line 326:2), /Users/honk/code/nostrstack/apps/gallery/src/TelemetryCard.tsx (Line 325:17 - Line 330:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn50" onclick="toggleCodeBlock('cloneGroup50', 'expandBtn50', 'collapseBtn50')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn50" onclick="toggleCodeBlock('cloneGroup50', 'expandBtn50', 'collapseBtn50')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup50"><code class="language-tsx text-sm text-gray-800">background: tone.dot,
                  animation: status === 'open' ? 'nostrstack-pulse-soft 1.8s infinite' : 'none',
                  ...(status === 'open' ? ({ '--nostrstack-pulse-color': tone.dot } as Record&lt;string, string&gt;) : {})
                } as React.CSSProperties}
              /&gt;
              &lt;</code></pre></div><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/apps/gallery/src/KeyToggle.tsx (Line 92:1 - Line 98:2), /Users/honk/code/nostrstack/apps/gallery/src/NpubBar.tsx (Line 202:1 - Line 208:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn51" onclick="toggleCodeBlock('cloneGroup51', 'expandBtn51', 'collapseBtn51')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn51" onclick="toggleCodeBlock('cloneGroup51', 'expandBtn51', 'collapseBtn51')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup51"><code class="language-tsx text-sm text-gray-800">};

function middleTruncate(value: string, keep = 10) {
  if (!value) return value;
  if (value.length &lt;= keep * 2 + 3) return value;
  return `${value.slice(0, keep)}…${value.slice(-keep)}`;
}</code></pre></div><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/apps/gallery/src/InvoicePopover.tsx (Line 26:2 - Line 34:13), /Users/honk/code/nostrstack/apps/gallery/src/PayToUnlockCard.tsx (Line 252:2 - Line 261:12)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn52" onclick="toggleCodeBlock('cloneGroup52', 'expandBtn52', 'collapseBtn52')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn52" onclick="toggleCodeBlock('cloneGroup52', 'expandBtn52', 'collapseBtn52')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup52"><code class="language-tsx text-sm text-gray-800">= useMemo(() =&gt; {
    const secs = Math.max(0, Math.floor(ageMs / 1000));
    const m = Math.floor(secs / 60)
      .toString()
      .padStart(2, '0');
    const s = (secs % 60).toString().padStart(2, '0');
    return `${m}:${s}`;
  }, [ageMs]);
  const fmtRemaining</code></pre></div><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/apps/gallery/src/CopyButton.tsx (Line 105:10 - Line 119:11), /Users/honk/code/nostrstack/apps/gallery/src/CopyButton.tsx (Line 86:10 - Line 100:16)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn53" onclick="toggleCodeBlock('cloneGroup53', 'expandBtn53', 'collapseBtn53')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn53" onclick="toggleCodeBlock('cloneGroup53', 'expandBtn53', 'collapseBtn53')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup53"><code class="language-tsx text-sm text-gray-800">() {
  return (
    &lt;svg
      viewBox=&quot;0 0 24 24&quot;
      width=&quot;20&quot;
      height=&quot;20&quot;
      fill=&quot;none&quot;
      stroke=&quot;currentColor&quot;
      strokeWidth=&quot;2.5&quot;
      strokeLinecap=&quot;round&quot;
      strokeLinejoin=&quot;round&quot;
      focusable=&quot;false&quot;
      aria-hidden=&quot;true&quot;
    &gt;
      &lt;path d=&quot;M18 6 6 18</code></pre></div><!-- Add more clone groups for .txt format as needed         // Add more clone groups for .txt format as needed--></div><a name="markup-clones"></a><h2 class="text-2xl font-semibold text-gray-700 mb-4">markup</h2><div class="divide-y divide-gray-200 border-b-2"><!-- Add more clone groups for .txt format as needed         // Add more clone groups for .txt format as needed--></div><a name="json-clones"></a><h2 class="text-2xl font-semibold text-gray-700 mb-4">json</h2><div class="divide-y divide-gray-200 border-b-2"><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/apps/api/openapi.json (Line 177:21 - Line 209:19), /Users/honk/code/nostrstack/apps/api/openapi.json (Line 145:15 - Line 177:21)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn63" onclick="toggleCodeBlock('cloneGroup63', 'expandBtn63', 'collapseBtn63')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn63" onclick="toggleCodeBlock('cloneGroup63', 'expandBtn63', 'collapseBtn63')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup63"><code class="language-json text-sm text-gray-800">: {
      &quot;post&quot;: {
        &quot;requestBody&quot;: {
          &quot;content&quot;: {
            &quot;application/json&quot;: {
              &quot;schema&quot;: {
                &quot;type&quot;: &quot;object&quot;,
                &quot;properties&quot;: {
                  &quot;domain&quot;: {
                    &quot;type&quot;: &quot;string&quot;
                  },
                  &quot;displayName&quot;: {
                    &quot;type&quot;: &quot;string&quot;
                  }
                },
                &quot;required&quot;: [
                  &quot;domain&quot;,
                  &quot;displayName&quot;
                ],
                &quot;additionalProperties&quot;: false
              }
            }
          },
          &quot;required&quot;: true
        },
        &quot;responses&quot;: {
          &quot;200&quot;: {
            &quot;description&quot;: &quot;Default Response&quot;
          }
        }
      }
    },
    &quot;/api/admin/users&quot;</code></pre></div><!-- Add more clone groups for .txt format as needed         // Add more clone groups for .txt format as needed--></div><a name="bash-clones"></a><h2 class="text-2xl font-semibold text-gray-700 mb-4">bash</h2><div class="divide-y divide-gray-200 border-b-2"><!-- Add more clone groups for .txt format as needed         // Add more clone groups for .txt format as needed--></div><a name="css-clones"></a><h2 class="text-2xl font-semibold text-gray-700 mb-4">css</h2><div class="divide-y divide-gray-200 border-b-2"><!-- Add more clone groups for .txt format as needed         // Add more clone groups for .txt format as needed--></div><a name="markdown-clones"></a><h2 class="text-2xl font-semibold text-gray-700 mb-4">markdown</h2><div class="divide-y divide-gray-200 border-b-2"><!-- Add more clone groups for .txt format as needed         // Add more clone groups for .txt format as needed--></div><a name="yaml-clones"></a><h2 class="text-2xl font-semibold text-gray-700 mb-4">yaml</h2><div class="divide-y divide-gray-200 border-b-2"><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/deploy/regtest/docker-compose.yml (Line 64:10 - Line 80:6), /Users/honk/code/nostrstack/deploy/regtest/docker-compose.yml (Line 30:13 - Line 46:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn61" onclick="toggleCodeBlock('cloneGroup61', 'expandBtn61', 'collapseBtn61')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn61" onclick="toggleCodeBlock('cloneGroup61', 'expandBtn61', 'collapseBtn61')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup61"><code class="language-yaml text-sm text-gray-800">:
    image: lightninglabs/lnd:v0.18.4-beta
    restart: unless-stopped
    depends_on:
      bitcoind:
        condition: service_healthy
    command:
      - --lnddir=/data
      - --bitcoin.active
      - --bitcoin.regtest
      - --bitcoin.node=bitcoind
      - --bitcoind.rpchost=bitcoind
      - --bitcoind.rpcuser=bitcoin
      - --bitcoind.rpcpass=bitcoin
      - --bitcoind.zmqpubrawblock=tcp://bitcoind:28332
      - --bitcoind.zmqpubrawtx=tcp://bitcoind:28333
      - --rpclisten=0.0.0.0:10010</code></pre></div><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/.github/workflows/ci.yml (Line 93:5 - Line 105:8), /Users/honk/code/nostrstack/.github/workflows/ci.yml (Line 22:5 - Line 34:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn64" onclick="toggleCodeBlock('cloneGroup64', 'expandBtn64', 'collapseBtn64')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn64" onclick="toggleCodeBlock('cloneGroup64', 'expandBtn64', 'collapseBtn64')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup64"><code class="language-yaml text-sm text-gray-800">steps:
      - uses: actions/checkout@v4
      - uses: pnpm/action-setup@v4
        with:
          version: 9.11.0
      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: 'pnpm'
      - name: Install
        run: pnpm install --frozen-lockfile
      - name: Restore</code></pre></div><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/.github/workflows/azure-deploy-staging.yml (Line 31:5 - Line 65:2), /Users/honk/code/nostrstack/.github/workflows/azure-deploy.yml (Line 31:5 - Line 64:13)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn65" onclick="toggleCodeBlock('cloneGroup65', 'expandBtn65', 'collapseBtn65')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn65" onclick="toggleCodeBlock('cloneGroup65', 'expandBtn65', 'collapseBtn65')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup65"><code class="language-yaml text-sm text-gray-800">services:
      postgres:
        image: postgres:15
        ports: [&quot;5432:5432&quot;]
        env:
          POSTGRES_USER: nostrstack
          POSTGRES_PASSWORD: nostrstack
          POSTGRES_DB: nostrstack
        options: &gt;-
          --health-cmd &quot;pg_isready -U nostrstack&quot; --health-interval=10s --health-timeout=5s --health-retries=5
    permissions:
      contents: read
      packages: write
      id-token: write
    steps:
      - uses: actions/checkout@v4

      - uses: pnpm/action-setup@v4
        with:
          version: 9.11.0

      - uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: pnpm

      - name: Install deps
        run: pnpm install --frozen-lockfile

      - name: Run tests
        run: pnpm test
        env:
          DATABASE_URL: postgresql://nostrstack:nostrstack@localhost:5432/nostrstack

      -</code></pre></div><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/.github/workflows/azure-deploy-staging.yml (Line 65:7 - Line 90:10), /Users/honk/code/nostrstack/.github/workflows/azure-deploy.yml (Line 71:7 - Line 96:11)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn66" onclick="toggleCodeBlock('cloneGroup66', 'expandBtn66', 'collapseBtn66')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn66" onclick="toggleCodeBlock('cloneGroup66', 'expandBtn66', 'collapseBtn66')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup66"><code class="language-yaml text-sm text-gray-800">- name: Set image tag
        id: vars
        run: |
          tag=&quot;${{ github.event.inputs.image_tag }}&quot;
          if [ -z &quot;$tag&quot; ]; then tag=&quot;${GITHUB_SHA}&quot;; fi
          echo &quot;IMAGE=${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}:${tag}&quot; &gt;&gt; $GITHUB_OUTPUT

      - name: Login to GHCR
        uses: docker/login-action@v3
        with:
          registry: ${{ env.REGISTRY }}
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}

      - name: Build &amp; push image
        uses: docker/build-push-action@v6
        with:
          context: .
          file: apps/api/Dockerfile

      - name: Azure login
        uses: azure/login@v2
        with:
          creds: ${{ secrets.AZURE_CREDENTIALS }}

      - name: Deploy Bicep (staging)</code></pre></div><!-- Add more clone groups for .txt format as needed         // Add more clone groups for .txt format as needed--></div><a name="python-clones"></a><h2 class="text-2xl font-semibold text-gray-700 mb-4">python</h2><div class="divide-y divide-gray-200 border-b-2"><div class="py-4"><p class="text-gray-600">/Users/honk/code/nostrstack/deploy/lnbits/db.py (Line 420:6 - Line 431:6), /Users/honk/code/nostrstack/deploy/lnbits/db.py (Line 227:2 - Line 238:3)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn62" onclick="toggleCodeBlock('cloneGroup62', 'expandBtn62', 'collapseBtn62')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn62" onclick="toggleCodeBlock('cloneGroup62', 'expandBtn62', 'collapseBtn62')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup62"><code class="language-python text-sm text-gray-800">)

    async def fetch_page(
        self,
        query: str,
        where: list[str] | None = None,
        values: dict | None = None,
        filters: Filters | None = None,
        model: type[TModel] | None = None,
        group_by: list[str] | None = None,
    ) -&gt; Page[TModel]:
        async</code></pre></div><!-- Add more clone groups for .txt format as needed         // Add more clone groups for .txt format as needed--></div></section><!-- Add more sections for other formats and clone groups as needed--></main><footer class="bg-white shadow mt-8 py-4"><div class="container mx-auto px-4 text-center"><p class="text-sm text-gray-600">This report is generated by jscpd, an open-source copy/paste detector.</p><p class="text-sm text-gray-600">jscpd is licensed under the MIT License.</p><a class="text-blue-500 text-sm" href="https://github.com/kucherenko/jscpd" target="_blank" rel="noopener noreferrer">View jscpd on GitHub</a></div></footer><script src="js/prism.js"></script><script>function toggleCodeBlock(codeBlockId, expandBtnId, collapseBtnId) {
  const codeBlock = document.getElementById(codeBlockId);
  const expandBtn = document.getElementById(expandBtnId);
  const collapseBtn = document.getElementById(collapseBtnId);

  codeBlock.classList.toggle('hidden');
  expandBtn.classList.toggle('hidden');
  collapseBtn.classList.toggle('hidden');
}</script></body></html>